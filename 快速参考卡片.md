# 战斗系统快速参考卡片

## 🚀 立即开始（3 步）

### 步骤 1：拉取最新代码
```bash
git pull origin master
```

### 步骤 2：编译项目
```
UE 编辑器 → Compile 按钮 (Ctrl+Alt+F11)
```

### 步骤 3：测试单位初始化
```
拖放 BP_步兵 到场景 → 运行游戏 → 查看血量是否正常
```

---

## 🎯 三大功能速查

### 1️⃣ 自动初始化系统
**功能：** 直接拖放的单位自动初始化属性

**如何使用：**
- 无需任何操作，自动生效
- 拖放单位到场景即可

**日志检查：**
```
LogSGGameplay: Warning: ⚠️ 检测到未初始化的单位，执行自动初始化
LogTemp: Log: ============AttributeSet初始化属性开始============
```

---

### 2️⃣ 攻击范围/视野可视化
**功能：** 实时显示攻击范围和视野范围

**如何开启：**
1. 选中场景中的单位
2. Details 面板 → `Debug Visualization`
3. 勾选：
   - ✅ `显示攻击范围` (红色圆圈)
   - ✅ `显示视野范围` (黄色圆圈)

**蓝图调用：**
```
ToggleAttackRangeVisualization()  // 切换攻击范围
ToggleVisionRangeVisualization()  // 切换视野范围
```

---

### 3️⃣ GE_Damage_Base 配置检查
**功能：** 确保伤害系统正常工作

**配置清单（5 项）：**
- [ ] Duration Policy = `Instant`
- [ ] Executions → Calculation Class = `SG_DamageExecutionCalc`
- [ ] Calculation Modifiers 已配置（AttackDamage, Source, false）
- [ ] Modifiers 数组为空
- [ ] SetByCaller → Data Tag = `Data.Damage`

**快速诊断：**
📄 参考文档：`GE_Damage_Base配置诊断.md`

---

## 📋 快速测试流程

### 测试 1：单位初始化（1 分钟）
```
1. 拖放 BP_步兵 到场景
2. 运行游戏 (PIE)
3. 查看日志：血量应该是 500，不是 0
```

### 测试 2：可视化（1 分钟）
```
1. 选中单位 → 勾选可视化开关
2. 运行游戏
3. 应该看到红色和黄色圆圈
```

### 测试 3：伤害测试（3 分钟）
```
1. 放置两个步兵（不同阵营）
2. 设置 Current Target
3. 调用 Perform Attack()
4. 查看日志：应该有伤害计算日志
```

**详细步骤：** 📄 `快速测试指南.md`

---

## 🐛 常见问题速查

| 问题 | 原因 | 解决方案 |
|------|------|----------|
| 血量为 0 | 未初始化 | 检查编译，查看日志 |
| 看不到圆圈 | 开关未开 | 勾选 bShowAttackRange |
| GE 应用失败 | 配置错误 | 检查 Modifiers 是否为空 |
| 没有伤害 | 攻击力为 0 | 检查属性初始化 |

---

## 📚 文档快速导航

| 文档 | 用途 | 阅读时间 |
|------|------|----------|
| 问题修复总结.md | 了解所有修改 | 5 分钟 |
| GE_Damage_Base配置诊断.md | 修复 GE 配置 | 10 分钟 |
| 快速测试指南.md | 完整测试流程 | 15 分钟 |
| 快速参考卡片.md | 快速查询 | 1 分钟 |

---

## 🎯 重点提醒

### ⚠️ 必须检查的配置
**GE_Damage_Base 的 Modifiers 数组必须为空！**

**为什么：**
- IncomingDamage 由 SG_DamageExecutionCalc 修改
- 在 Modifiers 中修改会导致失败

### ✅ 正确的伤害流程
```
1. 攻击能力激活
2. SG_DamageExecutionCalc 计算伤害
3. 伤害应用到 IncomingDamage
4. PostGameplayEffectExecute 转换为生命值扣除
```

---

## 🆘 需要帮助？

### 提供以下信息：
1. **日志输出**（完整）
2. **GE_Damage_Base 截图**（Details 面板）
3. **单位属性截图**（AttributeSet 值）
4. **错误描述**（具体现象）

### 联系方式：
- GitHub Issue
- 或直接回复

---

## 📊 版本信息

**Git Commit:** `5d9c918`
**提交时间:** 2025-01-XX
**分支:** `master`

**修改的文件：**
- `SG_UnitsBase.h`
- `SG_UnitsBase.cpp`
- `GE_Damage_Base配置诊断.md` (新增)
- `快速测试指南.md` (新增)
- `问题修复总结.md` (新增)
- `快速参考卡片.md` (新增)

---

## ✨ 下一步计划

测试通过后：
1. ⏳ 实现远程攻击系统
2. ⏳ 实现英雄技能（曹操、刘备）
3. ⏳ 实现策略卡系统
4. ⏳ 实现主城弓箭手系统

**让我们先确保基础战斗系统正常工作！** 🚀
